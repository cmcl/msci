% $Id: macros.tex,v 1.31 2007/05/21 11:52:37 stfm Exp $

\newtheorem{theorem}{Theorem}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{proposition}[theorem]{Proposition}

\hfuzz1pc % Don't bother to report overfull boxes if overage is < 1pc

% Listings
\usepackage{listings}
\lstset{language=Haskell,
  extendedchars=true,
%  showstringspaces=false,
  basicstyle=\sffamily\small\upshape,
  morekeywords={accept, request, send, on, receive, select, end, fork},
  literate=
    {lambda}{$\lambda$}1
    {->}{$\rightarrow$}1
    {-<}{$\leftarrow$}1
    {-o}{$\multimap$}1
    {=>}{$\Rightarrow$}1
    {<}{$\langle$}1
    {>}{$\rangle$}1
    {>^a}{{$\rangle^{\msf a}$}}1
    {>^r}{{$\rangle^{\msf r}$}}1
    {++}{$\oplus$}1
    {vdash}{$\vdash$}1
    {||}{$\parallel$}1
}

\newcommand{\stlc}{\lambda^\rightarrow}

\DeclareMathAlphabet{\mathsb}{OT1}{cmss}{bx}{n}
\newcommand{\msf}{\mathsf}
\newcommand{\msb}{\mathsb}
% Data types
\newcommand{\mktype}[1]{\mathsf{#1}}
\newcommand{\Int}{\mktype{Int}}
\newcommand{\Real}{\mktype{Real}}
\newcommand{\Bool}{\mktype{Bool}}
\newcommand{\Unit}{\mktype{Unit}}
\newcommand{\String}{\mktype{String}}
\newcommand{\carry}[1]{[{#1}]} % Derived!
\newcommand{\tensor}[2]{{#1}\otimes{#2}}
\newcommand{\fn}[2]{{#1}\rightarrow{#2}}
\newcommand{\lfnrel}{\multimap}
\newcommand{\lfn}[2]{{#1}\lfnrel{#2}}
\newcommand{\access}[2]{\langle{#1},{#2}\rangle}
\newcommand{\accessproj}[2][*]{\langle{#2}\rangle^{#1}}
\newcommand{\reqaccess}[1]{\accessproj[\mkterm r]{#1}}
\newcommand{\accaccess}[1]{\accessproj[\mkterm a]{#1}}
% Session types
\newcommand{\End}{\mktype{end}}
\newcommand{\Arbitrary}{\mktype{Arbitrary}}
\newcommand{\inpt}[2]{?{#1}.{#2}}
\newcommand{\outpt}[2]{!{#1}.{#2}}
\newcommand{\Branch}[3]{\&\langle{#1}\colon{#2}\rangle_{#3}}
\newcommand{\Choice}[3]{\oplus\langle{#1}\colon{#2}\rangle_{#3}}
%\newcommand{\rectype}[2]{\mu{#1}\cdot{#2}}
\newcommand{\rectype}[2]{\mu{#1}.{#2}}
\newcommand{\dual}[1]{\overline{#1}}
\newcommand{\dualr}{\perp}
\newcommand{\funtype}[2]{{#1}\rightarrow{#2}}
\newcommand{\prodtype}[2]{{#1}\times{#2}}
\newcommand{\lin}[1]{\mathsf{lin}{#1}}
\newcommand{\variant}[1]{\langle{#1}\rangle}
\newcommand{\tredrel}{\mapsto}
\newcommand{\tred}[2]{{#1}\tredrel{#2}}
\newcommand{\tredst}[2]{{#1}\tredrel^{*}{#2}}
%\newcommand{\SType}{\mathit{SType}}
\newcommand{\SType}{\mathcal{S}}
%\newcommand{\Type}{\mathit{Type}}
\newcommand{\Type}{\mathcal{T}}
% Components of session types
\newcommand{\seqt}{\mathbin{.}}
\newcommand{\brt}{\mathsf{\&}}
\newcommand{\cht}{\mathsf{\oplus}}
\newcommand{\inptpref}{\mathsf{?}}
\newcommand{\outptpref}{\mathsf{!}}
\newcommand{\Bottom}{\bot}
\newcommand{\Pitype}[3]{\Pi{#1}\colon{#2}.{#3}}
% Channel pointer
%\newcommand{\Chan}[1]{\mktype{Chan}１ヒ彐弪孱沐豉疱ボ铄縻镯磲钿芤彐郾蓰茼媵疱义纨１藻蝽豉疱茴鬻泔眄犷潲茚蝌秣豉疱鄄蓰１茯殓梏狎蝻鼷２茴鬻泔眄犷潲荇孱篝疱鄄蓰１茱糸礤篼２茴鬻泔眄犷潲茔镯瘕茆蹯戾酏御铘狲镦翦蝽脲黠蜾茴鬻泔眄犷潲茼媵弪睚郾蓰茼狒梵纣１茴鬻泔眄犷潲荇蝓妪茼媵弪睇趄蹂茴鬻泔眄犷潲苕犰箦茼媵弪睇驷祗妪茴鬻泔眄犷潲荃铋酏茼媵弪睇躅轸茴鬻泔眄犷潲荛骠弪睚茼媵弪睇殒茴鬻泔眄犷潲荇桢铘弪睚茼媵弪睇翳孱茴鬻泔眄犷潲苕矧媵弪睚茼媵弪睇骘螂茴鬻泔眄犷潲荏孱漪弪睚茼媵弪睇箦钿茴鬻泔眄犷潲茯邈彘鲥翦蝽茼媵弪睇蝈沐轹妪茴鬻泔眄犷潲荃铈镬漪弪睚茼媵弪睇躅骘熹茴鬻泔眄犷潲茚沣屦趑弪睚茼媵弪睇徙沐痿茴鬻泔眄犷潲茯羼蹂篝翦蝽茼媵弪睇蝈聃弩酏茴鬻泔眄犷潲茴鬻翦蝽茴觚茴鬻泔眄犷潲莒弭翦蝽茼媵弪睇戾酏茴鬻泔眄犷潲荛铘弪睚茼媵弪睇轭茴鬻泔眄犷潲茆蝈犭翦蝽茼媵弪睇怛遽臊茴鬻泔眄犷潲茔狍弭弪睚茼媵弪睇汜箦茴鬻泔眄犷潲荏屐邈趑弪睚茼媵弪睇箦戾泗茴鬻泔眄犷潲茱骠弪睚茼媵弪睇镦茴鬻泔眄犷潲茱铘弪睚茼媵弪睇镱茴鬻泔眄犷潲茯邈翦蝽茼媵弪睇蝈泯茴鬻泔眄犷潲苕轼翦蝽茼媵弪睇骈泔铙趄蹉麸蝮茴鬻泔眄犷潲茴鬻鄄蓰茴鬻翦蝽１２茴鬻泔眄犷潲茔镱潺鄢蓰茼媵弪睇殒１茼媵弪睇翳孱２茼媵弪睇屐箦３茴鬻泔眄犷潲荏孱潺鄄蓰荏孱漪弪睨１２茴鬻泔眄犷潲茯邈彘鲥郾蓰茯邈彘鲥翦蝽１茴鬻泔眄犷潲茯邈彘鲥汨犷郾蓰茼媵弪睇蝈沐轹迕栳铨１茴鬻泔眄犷潲茕弪彐郾蓰茼媵弪睇↓１茴鬻泔眄犷潲茚篌殓铨鄄蓰１茼媵弪睇航２茴鬻泔眄犷潲芴弭鄢蓰莒弭翦蝽１禁２荛铘弪睨３ボ铄縻镯磲钿芴弭疳轵鄞蓰莒弭翦蝽莛衢螓１２禁３荛铘弪睨４茴鬻泔眄犷潲芴弭疳轵鄞蓰莒弭翦蝽１２禁３荛铘弪睨４茴鬻泔眄犷潲苕矧臊郾蓰苕矧媵弪睨１茴鬻泔眄犷潲茯羼蹂篝鄄蓰茯羼蹂篝翦蝽１２茴鬻泔眄犷潲茚沣屦酏鄄蓰茚沣屦趑弪睨１２茴鬻泔眄犷潲茔箦鄄蓰茔狍弭弪睨１茱骠弪睨２茴鬻泔眄犷潲荏屐邈酏鄄蓰荏屐邈趑弪睨１２茴鬻泔眄犷潲荇栩遽潺郾蓰莒犷珈妍１茯犷珈妪茴鬻泔眄犷潲莒弭翳蝈徜郾蓰莒犷珈妍芴弭１酏茯犷珈妪茴鬻泔眄犷潲莒弭翳蝈徜镱妪郾蓰莒犷珈妍芴弭１暨饼茯犷珈妪茴鬻泔眄犷潲莒弭翳蝈徜赭稞郾蓰莒犷珈妍芴弭１暨昌茯犷珈妪茴鬻泔眄犷潲莒弭翳蝈徜翳蝈妪郾蓰莒犷珈妍芴弭１暨除茯犷珈妪茴鬻泔眄犷潲茚蝌秣茯殓梏狎蝻鼾茴鬻泔眄犷潲莒忪郾蓰茼狒栝酐１茴鬻泔眄犷潲茔狍邂蝮鄢蓰茺１茔镬镱２荦啕３茴鬻泔眄犷潲苊狍邂蝮鄢蓰茺１茚蝌秣２荦啕３灬悦茴鬻泔眄犷潲荃铈镬潺郾蓰荃铈镬漪弪悫１茴鬻泔眄犷潲荏殓磲忾钿鄄蓰茺１荦２茴鬻泔眄犷潲莛衢螨鄄蓰茼狒梵纣１２茼狒梵纣茴鬻泔眄犷潲荇蜷痨妪鄢蓰茼狒梵纣１２３茼狒梵纣茴鬻泔眄犷潲茯邈鄄蓰茯邈翦蝽１２躅豉疱茴鬻泔眄犷潲芤邈鄢蓰茯邈翦蝽１茔镬镱２┊３豉疱茴鬻泔眄犷潲苕轼郾蓰苕轼翦蝽１茴鬻泔眄犷潲莒轭徕簖鄢蓰莒犴怃徇忑１堋很←２３豉疱茴鬻泔眄犷潲茚怏鄄蓰莒犴怃猁１２茴鬻泔眄犷潲芰怏鄞蓰莒犴怃屺１畸２茔镬镱３┊４豉疱茴鬻泔眄犷潲茔镱泯茼殇茴鬻泔眄犷潲芪觚鄄蓰ㄜ铛１２茴鬻泔眄犷潲苕狨祠泔铈芪觖荟邈钴泔祜钴汜蝌荟邈育芪觖荟邈泯芪觖荟邈潺眠避泔钽眠博茴鬻泔眄犷潲苕鳊茼狒栝酐骣茴鬻泔眄犷潲苕泯茼狒栝酐驺碰犰踽糸镱泔铘屮趔茴鬻泔眄犷潲茔豇酏鄄蓰１郏草茴鬻泔眄犷潲莒孱郾蓰１赠痖铉牾溏屙孱趔茴鬻泔眄犷潲莒轭遽螨茼狒梵纣扉铨茴鬻泔眄犷潲荃铎轫茼狒梵纣躅茴鬻泔眄犷潲荇疱溻蹑纨鄢蓰１荟溽箬２茔镬镱３ボ铄縻镯磲钿荇疱溷鄞蓰１荟溽箬啕２３茔镬镱４ボ铄縻镯磲钿荇疱溷鄞蓰１荟溽箬啕２３荇蜷犷珈弪殓梏４茴鬻泔眄犷潲荇疱溷镱纨鄢蓰１荟溽箬２荇蜷犷珈弪殓梏３茴鬻泔眄犷潲荇疱漩犰蹂鄢蓰１荟溽箬２茔镬镱３茴鬻泔眄犷潲荇疱潺鄣蓰１荟溽箬２荇蜷犷珈弪殓梏３茔镬镱４荇蜷犷珈屐彐酐５茴鬻泔眄犷潲荇疱溟潺鄄蓰１茔镬镱２茴鬻泔眄犷潲荇疱溷镱篝鄄蓰１茔镬镱２茴鬻泔眄犷潲荇疱溴瘕鄢蓰１荟溽箬２茔镬镱３茴鬻泔眄犷潲荇疱溻蹑鄢蓰１荟溽箬２茔镬镱３茴鬻泔眄犷潲荇疱溴铘蝙鄢蓰１荟溽箬２茼狃篝稃３茴鬻泔眄犷潲荇疱镦郾蓰茼狒栝酐豉疱镦１茼狒栝酐茴鬻泔眄犷潲荇疱潴鄞蓰１荇蜷犷珈弪殓梏２茔镬镱３荇蜷犷珈屐彐酐４ボ铄縻镯磲钿茔镯疳酏鄄蓰１茚簌眇２茴鬻泔眄犷潲茔镯疳酏茚簌眇赠痖铉牾溏屙孱趔骘豉疱汨邈腴铉茴鬻泔眄犷潲荠殄熹簖茼狃篝稞茴鬻泔眄犷潲茔桢汶泔铈鄢蓰１畸２荠殄熹篼３茴鬻泔眄犷潲茔桢汶鲠祯妪鄢蓰１畸２荠殄熹篼３茴鬻泔眄犷潲茔桢汶屮瘕鄞蓰１畸２荠殄熹篼３畸４茴鬻泔眄犷潲荇疱簖荟溽箬赠痖铉牾溏屙孱趔鏖翳泔铙趄衢铘茴鬻泔眄犷潲茔豉疱溷镱纨鄞蓰１荟溽箬２荇蜷犷珈弪殓梏３墁墁４茴鬻泔眄犷潲茔豉疱漩犰蹂鄞蓰１荟溽箬２茔镬镱３墁墁４茴鬻泔眄犷潲茔豉疱潺鄱蓰１荟溽箬２荇蜷犷珈弪殓梏３茔镬镱４荇蜷犷珈屐彐酐５墁墁６ビ踱豉痖铉茴鬻泔眄犷潲荏踱酏茼狒栩屐茼狒梵纣己ネ狒汨轭ㄢ弭麇孱怩骀弪豉疱犷箦篌轱豉疱螬ボ铄縻镯磲钿茼狒汨弩鄢蓰１荟溽箬２茼狒汨弩翦蝽３茴鬻泔眄犷潲茼狒汨弩鄄蓰１茼狒汨弩翦蝽２茴鬻泔眄犷潲茚骠弪鄄蓰１２ヂ纹溴骈铋糸镱茴鬻泔眄犷潲茆铈汉烬茴鬻泔眄犷潲茚祠
%Reduction
\newcommand{\vredrel}{\longrightarrow_{\mathsf{v}}}
\newcommand{\vred}[2]{{#1}\vredrel{#2}}
\newcommand{\ared}[2]{{#1}\longrightarrow{#2}}
\newcommand{\credl}[5]{{#1},{#2}\stackrel{#3}{\longrightarrow}{#4},{#5}}
\newcommand{\sred}[2]{{#1}\longrightarrow{#2}}

\newcommand{\tableentry}[4]{{#1}\mapsto({#2},{#3},{#4})}
\newcommand{\emptyseq}{\varepsilon}
% Functions and predicates
\newcommand{\dom}{\operatorname{dom}}
\newcommand{\cdom}{\operatorname{cdom}}
\newcommand{\peer}[1]{\operatorname{peer}_{#1}}
\newcommand{\data}[1]{\operatorname{data}_{#1}}
\newcommand{\type}[1]{\operatorname{type}_{#1}}
\newcommand{\matchesterm}{\operatorname{matches}}
\newcommand{\bound}{\operatorname{bound}}
% Note: max is predefined

\newcommand{\parts}[1]{{\cal P}({#1})}
% Substitution and map
\newcommand{\subs}[2]{\{{#1}/{#2}\}}
\newcommand{\subst}[3]{{#1}\subs{#2}{#3}}
\newcommand{\map}[1]{[\![{#1}]\!]}
\newcommand{\D}{\mathcal{D}}
% Rule names
\newcommand{\mkRrule}[1]{\textsc{R-#1}}
\newcommand{\mkSrule}[1]{\textsc{E-#1}}
\newcommand{\mkTrule}[1]{\textsc{T-#1}}
\newcommand{\mkCrule}[1]{\textsc{C-#1}}
\newcommand{\mkSTrule}[1]{\textsc{S-#1}}
%
\newcommand{\Rlet}{\mkRrule{Let}}
\newcommand{\RletPair}{\mkRrule{LetPair}}
\newcommand{\Rsplit}{\mkRrule{Split}}
\newcommand{\Rnew}{\mkRrule{New}}
\newcommand{\Rbranch}{\mkRrule{Branch}}
\newcommand{\Rapp}{\mkRrule{App}}
\newcommand{\RappU}{\mkRrule{AppU}}
\newcommand{\RappL}{\mkRrule{AppL}}
\newcommand{\Rcom}{\mkRrule{Com}}
\newcommand{\Rinit}{\mkRrule{Init}}
\newcommand{\Rchan}{\mkRrule{New}}
\newcommand{\Rrequest}{\mkRrule{Request}}
\newcommand{\Raccept}{\mkRrule{Accept}}
\newcommand{\Rift}{\mkRrule{IfT}}
\newcommand{\Riff}{\mkRrule{IfF}}
\newcommand{\Rseq}{\mkRrule{Seq}}
\newcommand{\Rsend}{\mkRrule{Send}}
\newcommand{\Rreceive}{\mkRrule{Receive}}
\newcommand{\RsendChan}{\mkRrule{SendS}}
\newcommand{\RreceiveChan}{\mkRrule{ReceiveS}}
\newcommand{\Rcase}{\mkRrule{Case}}
\newcommand{\Rselect}{\mkRrule{Select}}
\newcommand{\Runfold}{\mkRrule{Unfold}}
\newcommand{\Rprotocol}{\mkRrule{Protocol}}
\newcommand{\Rcontext}{\mkRrule{Context}}
\newcommand{\Rbeta}{\mkRrule{Beta}}
\newcommand{\Rfix}{\mkRrule{Fix}}
\newcommand{\Rrec}{\mkRrule{Rec}}
\newcommand{\Rconf}{\mkRrule{Conf}}
\newcommand{\Rfork}{\mkRrule{Fork}}
\newcommand{\Rpar}{\mkRrule{Par}}
\newcommand{\RnewC}{\mkRrule{NewC}}
\newcommand{\RnewN}{\mkRrule{NewN}}
\newcommand{\Rcong}{\mkRrule{Cong}}
\newcommand{\Rstruct}{\mkRrule{Struct}}
\newcommand{\Rconnect}{\mkRrule{Connect}}
\newcommand{\Rsync}{\mkRrule{Sync}}
\newcommand{\Rthread}{\mkRrule{Thread}}
%
\newcommand{\Scomm}{\mkSrule{Comm}}
\newcommand{\Sassoc}{\mkSrule{Assoc}}
\newcommand{\Smon}{\mkSrule{Monoid}}
\newcommand{\Sscope}{\mkSrule{Scope}}
\newcommand{\SscopeC}{\mkSrule{ScopeC}}
\newcommand{\SscopeN}{\mkSrule{ScopeN}}
%
\newcommand{\Tthread}{\mkTrule{Thread}}
\newcommand{\Tpar}{\mkTrule{Par}}
\newcommand{\Trequest}{\mkTrule{Request}}
\newcommand{\Taccept}{\mkTrule{Accept}}
\newcommand{\Tfork}{\mkTrule{Fork}}
\newcommand{\Tval}{\mkTrule{Val}}
\newcommand{\Telim}{\mkTrule{$\forall$E}}
\newcommand{\Tconst}{\mkTrule{Const}}
\newcommand{\Tid}{\mkTrule{Id}} % Var ou Channel
\newcommand{\Tvar}{\mkTrule{Var}}
\newcommand{\TvarL}{\mkTrule{VarL}}
\newcommand{\TvarU}{\mkTrule{VarU}}
\newcommand{\Tnam}{\mkTrule{Name}}
\newcommand{\Tnew}{\mkTrule{New}}
\newcommand{\Tres}{\mkTrule{Res}}
\newcommand{\Ttrue}{\mkTrule{True}}
\newcommand{\Tfalse}{\mkTrule{False}}
\newcommand{\Trec}{\mkTrule{Rec}}
\newcommand{\Tif}{\mkTrule{If}}
\newcommand{\Tlet}{\mkTrule{Let}}
\newcommand{\TletPair}{\mkTrule{LetPair}}
\newcommand{\Tpolylet}{\mkTrule{PolyLet}}
\newcommand{\Tintro}{\mkTrule{$\forall$I}}
\newcommand{\Tseq}{\mkTrule{Seq}}
\newcommand{\Tchanid}{\mkTrule{Chan}}
\newcommand{\Tchan}{\mkTrule{Chan}}
\newcommand{\Tsend}{\mkTrule{Send}}
\newcommand{\Treceive}{\mkTrule{Receive}}
\newcommand{\TsendChan}{\mkTrule{SendS}}
\newcommand{\TreceiveChan}{\mkTrule{ReceiveS}}
\newcommand{\TreceiveOrTreceiveChan}{\mkTrule{Receive}}
\newcommand{\Tselect}{\mkTrule{Select}}
\newcommand{\Tcase}{\mkTrule{Case}}
\newcommand{\Tfold}{\mkTrule{Fold}}
\newcommand{\Tunfold}{\mkTrule{Unfold}}
\newcommand{\TabsU}{\mkTrule{AbsU}}
\newcommand{\TabsL}{\mkTrule{AbsL}}
\newcommand{\Tabs}{\mkTrule{Abs}}
\newcommand{\TappU}{\mkTrule{AppU}}
\newcommand{\TappL}{\mkTrule{AppL}}
\newcommand{\Tapp}{\mkTrule{App}}
\newcommand{\Tweak}{\mkTrule{Weak}}
\newcommand{\Tloop}{\mkTrule{Loop}}
\newcommand{\TnewN}{\mkTrule{NewN}}
\newcommand{\TnewC}{\mkTrule{NewC}}
\newcommand{\TnewB}{\mkTrule{NewB}}   % c : Bottom
\newcommand{\Tpair}{\mkTrule{Pair}}
\newcommand{\Tfix}{\mkTrule{Fix}}
\newcommand{\Tbuffer}{\mkTrule{Buffer}}
\newcommand{\Tentry}{\mkTrule{Entry}}
\newcommand{\Tjoin}{\mkTrule{Join}}
\newcommand{\Ttable}{\mkTrule{Table}}
\newcommand{\Tconf}{\mkTrule{Conf}}
\newcommand{\Tempty}{\mkTrule{Empty}}
\newcommand{\TaddBuffers}{\mkTrule{AddBuffers}}
\newcommand{\Tlookup}{\mkTrule{Lookup}}
\newcommand{\Tsplit}{\mkTrule{Split}}
\newcommand{\Tsub}{\mkTrule{Sub}}
\newcommand{\Tlabel}{\mkTrule{Label}}
\newcommand{\TseqV}{\mkTrule{SeqV}}
\newcommand{\TseqL}{\mkTrule{SeqL}}
\newcommand{\TtopLevel}{\mkTrule{TopLevel}}
%
\newcommand{\Cabs}{\mkCrule{Abs}}
\newcommand{\Crec}{\mkCrule{Rec}}
\newcommand{\Creceive}{\mkCrule{ReceiveD}}
\newcommand{\CreceiveChan}{\mkCrule{ReceiveS}}
\newcommand{\Csend}{\mkCrule{SendD}}
\newcommand{\CsendChan}{\mkCrule{SendS}}
\newcommand{\Cselect}{\mkCrule{Select}}
\newcommand{\Cfork}{\mkCrule{Fork}}
\newcommand{\Cnew}{\mkCrule{New}}
\newcommand{\Capp}{\mkCrule{App}}
\newcommand{\Cval}{\mkCrule{Val}}
\newcommand{\Cif}{\mkCrule{If}}
\newcommand{\Clet}{\mkCrule{Let}}
\newcommand{\Caccept}{\mkCrule{Accept}}
\newcommand{\Crequest}{\mkCrule{Request}}
\newcommand{\Cthread}{\mkCrule{Thread}}
\newcommand{\Cpar}{\mkCrule{Par}}
\newcommand{\CnewN}{\mkCrule{NewN}}
\newcommand{\CnewB}{\mkCrule{NewB}}
\newcommand{\CnewC}{\mkCrule{NewC}}
\newcommand{\Cconst}{\mkCrule{Const}}
\newcommand{\Cchanid}{\mkCrule{Chan}}
\newcommand{\Cnam}{\mkCrule{Name}}
\newcommand{\Cvar}{\mkCrule{Var}}
\newcommand{\Ccase}{\mkCrule{Case}}
%
\newcommand{\STrefl}{\mkSTrule{Refl}}
\newcommand{\STtrans}{\mkSTrule{Trans}}
\newcommand{\STfun}{\mkSTrule{Fun}}
\newcommand{\STfunl}{\mkSTrule{FunL}}
\newcommand{\STfunfun}{\mkSTrule{FunFun}}
\newcommand{\STin}{\mkSTrule{In}}
\newcommand{\STout}{\mkSTrule{Out}}
\newcommand{\STbranch}{\mkSTrule{Branch}}
\newcommand{\STchoice}{\mkSTrule{Choice}}


%Session type macros from ESOP paper
\newcommand{\lbldt}[2]{{#1}\colon{#2}}
\newcommand{\lbldc}[2]{{#1}\mathrel{.}{#2}}
\newcommand{\nil}{\mathsf{nil}}
\newcommand{\inp}[3]{{#1}\mathsf{?}{#2}\mathbin{.}{#3}}
\newcommand{\outp}[3]{{#1}\mathsf{!}{#2}\mathbin{.}{#3}}
\newcommand{\rep}{!}
\newcommand{\offer}{\mathbin{\triangleright}}
\renewcommand{\choose}{\mathbin{\triangleleft}}
\newcommand{\cname}[1]{\mathsf{#1}}
\newcommand{\lname}[1]{\mathsf{#1}}
\newcommand{\pname}[1]{\mathsf{#1}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\Ninf}{\mathbb{N}^\infty}

% TODO
\newcommand{\todo}[1]{\textbf{[TODO: {#1}]}}

% Layout
\newenvironment{myfigure}{\begin{figure}[t]}{\end{figure}}
%\newcommand{\mycaption}[1]{\vspace{-5ex}\caption{#1}}
\newcommand{\mycaption}[1]{\caption{#1}}
\newcommand{\mysubsection}[1]{\paragraph*{#1.}}
\newcommand{\typingRuleSkip}{0ex}

\usepackage{stmaryrd}
\usepackage{proof}
\usepackage{amssymb}
\usepackage{color}

%%%%%%%%%%%%%%%%%%%%%% Wadler's CP/GV commands %%%%%%%%%%%%%%%%%%%%%%%%%

% IMPORTANT!

% To typeset this paper for color, use the first definition below.
% To typeset this paper for black and white, use the second definition.

\newcommand{\incolor}[1]{#1}    % Use to typeset in color
%\newcommand{\incolor}[1]{}     % Use to typeset in black and white

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% color framework

\newcommand{\judgecolor}{}
\newcommand{\typecolor}{}
\newcommand{\termcolor}{}
\newcommand{\Typecolor}{}
\newcommand{\Termcolor}{}

\newcommand{\uncolored}{
  \incolor{
    \renewcommand{\judgecolor}{}
    \renewcommand{\typecolor}{}
    \renewcommand{\termcolor}{}
    \renewcommand{\Typecolor}{}
    \renewcommand{\Termcolor}{}
  }
}

\newcommand{\colored}{
  \incolor{
    \renewcommand{\judgecolor}{\color{black}}
    \renewcommand{\typecolor}{\color{blue}}
    \renewcommand{\termcolor}{\color{red}}
    \renewcommand{\Typecolor}{\color{black}}
    \renewcommand{\Termcolor}{\color{magenta}}
  }
}

\newcommand{\jd}[1]{{\judgecolor #1}}
\newcommand{\tp}[1]{{\typecolor #1}}
\newcommand{\tm}[1]{{\termcolor #1}}
\newcommand{\Tp}[1]{{\Typecolor #1}}
\newcommand{\Tm}[1]{{\Termcolor #1}}

\newcommand{\tmof}[1]{\tm{#1:{}}}
\newcommand{\Tmof}[1]{\Tm{#1:{}}}
\newcommand{\tmsem}[1]{\tm{\sem{\Tm{#1}}}}
\newcommand{\tpsem}[1]{\tp{\sem{\Tp{#1}}}}
\newcommand{\tmSem}[1]{{\termcolor \left\llbracket
                        \judgecolor #1
                        \termcolor \right\rrbracket}}

\newcommand{\tpvdash}{\tp{{} \vdash {}}}
\newcommand{\Tpvdash}{\Tp{{} \vdash {}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newenvironment{note}{\begin{trivlist} \item \textbf{Note. }}{\end{trivlist}}

\newcommand{\etal}{\emph{etal.}}

\newcommand{\dualbt}[1]{#1^\bot}
\newcommand{\of}[1]{\,{:}\,{#1}}
% \newcommand{\Of}[1]{\of{#1}}
\newcommand{\Of}[1]{}
% \newcommand{\OF}[1]{\of{#1}}
\newcommand{\OF}[1]{}
\newcommand{\all}[1]{\forall #1.}
\newcommand{\any}[1]{\exists #1.}
%% \newcommand{\with}{\mathbin{\binampersand}}
%% \newcommand{\parr}{\mathbin{\bindnasrepma}}
\newcommand{\lolli}{\multimap}
\newcommand{\link}{{\leftrightarrow}}
\newcommand{\semi}{;\;}
\newcommand{\comma}{,\,}
\newcommand{\Ax}{\key{Ax}}
\newcommand{\Cut}{\key{Cut}}
\newcommand{\Weaken}{\key{Weaken}}
\newcommand{\Contract}{\key{Contract}}
\newcommand{\Swap}{\key{Swap}}
\newcommand{\Assoc}{\key{Assoc}}
\newcommand{\pwEnd}{\key{end}}
\newcommand{\defeq}{\stackrel{\mathrm{def}}{=}}
\newcommand{\app}{\:}
\newcommand{\lam}[1]{\lambda #1.}
\newcommand{\Lam}[1]{\Lambda #1.}
\newcommand{\pwlin}{\key{lin}}
\newcommand{\un}{\key{un}}
\newcommand{\pwfn}{\key{fn}}
\newcommand{\pwfv}{\key{fv}}
\newcommand{\key}{\textsf}
%\newcommand{\key}{\textrm}
\newcommand{\becomes}{\Longrightarrow}
\newcommand{\sem}[1]{\llbracket #1 \rrbracket}
\newcommand{\Sem}[1]{\left\llbracket #1 \right\rrbracket}
% \newcommand{\sem}[1]{{#1^\dagger}}
% \newcommand{\Sem}[1]{{\left(#1\right)^\dagger}}
% \newcommand{\sem}[1]{[\![#1]\!]}
% \newcommand{\Sem}[1]{\left[\!\!\left[#1\right]\!\!\right]}
\newcommand{\ang}[1]{\langle #1 \rangle}
\newcommand{\set}[1]{\{ #1 \}}
\newcommand{\sub}{\set}
\newcommand{\intro}{\textsf{-I}}
\newcommand{\elim}{\textsf{-E}}
\newcommand{\pwoutp}[1]{{!#1}.}
\newcommand{\pwinp}[1]{{?#1}.}
\newcommand{\outend}{\key{end}_{!}}
\newcommand{\inend}{\key{end}_{?}}
\newcommand{\inference}[3]{\infer[\mathsf{#2}]{#3}{#1}}
\newcommand{\Inference}[3]{\infer=[\mathsf{#2}]{#3}{#1}}
\newcommand{\spacer}{\quad\quad\quad\quad}
\newcommand{\filler}{\hspace{0.9\textwidth}}
\newcommand{\tighten}{\vspace{-1ex}}
\newcommand{\permb}[2]{\left\{{#1}\leftrightsquigarrow{#2}\right\}}
\newcommand{\tpcp}{\tpvdash_{cp}}
